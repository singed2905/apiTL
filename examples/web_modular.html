<!-- Ensure parse module is loaded before vis2d3d.js -->
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ConvertKeylogApp Geometry API - Web Demo (Modular)</title>
  <link rel="stylesheet" href="assets/css/web.css" />
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ§® ConvertKeylogApp Geometry API</h1>
      <p>Web Demo - Chuyá»ƒn Ä‘á»•i bÃ i toÃ¡n hÃ¬nh há»c thÃ nh keylog mÃ¡y tÃ­nh Casio</p>
    </div>

    <div class="main-content">
      <div class="form-section">
        <h3>ğŸ“ Nháº­p dá»¯ liá»‡u</h3>
        <div class="form-group">
          <label for="operation">PhÃ©p toÃ¡n:</label>
          <select id="operation" onchange="updateShapeOptions(); updateVisualization();">
            <option value="">Chá»n phÃ©p toÃ¡n...</option>
          </select>
        </div>
        <div class="form-group">
          <label for="shapeA">HÃ¬nh A:</label>
          <select id="shapeA" onchange="updateInputFields(); updateVisualization();">
            <option value="">Chá»n hÃ¬nh A...</option>
          </select>
        </div>
        <div id="inputsA" class="shape-inputs"></div>
        <div class="form-group">
          <label for="shapeB">HÃ¬nh B (tÃ¹y chá»n):</label>
          <select id="shapeB" onchange="updateInputFields(); updateVisualization();">
            <option value="">KhÃ´ng cÃ³</option>
          </select>
        </div>
        <div id="inputsB" class="shape-inputs"></div>
        <div class="form-group">
          <label for="version">PhiÃªn báº£n mÃ¡y tÃ­nh:</label>
          <select id="version">
            <option value="fx799">Casio fx-799</option>
            <option value="fx800">Casio fx-800</option>
            <option value="fx801">Casio fx-801</option>
            <option value="fx802">Casio fx-802</option>
            <option value="fx803">Casio fx-803</option>
          </select>
        </div>
        <button class="btn" onclick="processGeometry()" id="processBtn">ğŸš€ TÃ­nh toÃ¡n</button>
      </div>

      <div class="results-section">
        <h3>ğŸ“ Visualization</h3>
        <div id="geometryPlot" style="width:100%; height:400px; border:1px solid #dee2e6; border-radius:8px;"></div>
        <div style="margin-top:10px; display:flex; gap:10px;">
          <button class="btn" style="width:auto" onclick="resetView()">ğŸ”„ Reset View</button>
          <button class="btn" style="width:auto" onclick="toggle3D()">ğŸ”„ 2D/3D</button>
        </div>
        <h3 style="margin-top:20px;">ğŸ“Š Káº¿t quáº£</h3>
        <div id="results"><div class="loading">Nháº­p dá»¯ liá»‡u vÃ  nháº¥n "TÃ­nh toÃ¡n" Ä‘á»ƒ xem káº¿t quáº£...</div></div>
        <div id="validationResults"></div>
      </div>

      <div class="examples-section">
        <h3>ğŸ’¡ VÃ­ dá»¥ nhanh</h3>
        <p style="margin-bottom: 15px;">Nháº¥n vÃ o má»™t vÃ­ dá»¥ Ä‘á»ƒ tá»± Ä‘á»™ng Ä‘iá»n dá»¯ liá»‡u:</p>
        <button class="example-btn" onclick="document.getElementById('operation').value='Khoáº£ng cÃ¡ch'; updateShapeOptions(); setTimeout(()=>{document.getElementById('shapeA').value='Äiá»ƒm'; document.getElementById('shapeB').value='Äiá»ƒm'; updateInputFields(); setTimeout(()=>{ const A=document.getElementById('point_input_A'); const B=document.getElementById('point_input_B'); if(A) A.value='1,2'; if(B) B.value='4,5'; updateVisualization(); },100); },100);">Khoáº£ng cÃ¡ch 2 Ä‘iá»ƒm</button>
      </div>

      <div class="excel-section">
        <h3>ğŸ“Š Excel Batch Processing (Frontend)</h3>
        <div class="upload-area" id="uploadArea">
          <input type="file" id="excelFile" accept=".xlsx,.xls" style="display: none;" onchange="handleExcelLocal()" />
          <div class="upload-zone" onclick="document.getElementById('excelFile').click()">
            <div class="upload-icon">ğŸ“</div>
            <p>Chá»n file Excel Ä‘á»ƒ Ä‘á»c trá»±c tiáº¿p trÃªn trÃ¬nh duyá»‡t</p>
            <small>FE parse & validate, BE chá»‰ xá»­ lÃ½ JSON</small>
          </div>
        </div>
        <div id="fileInfo" class="file-info" style="display: none;">
          <h4>ğŸ“‹ ThÃ´ng tin file:</h4>
          <div id="fileDetails"></div>
          <div id="previewTable"></div>
        </div>
        <div id="processingConfig" class="processing-config" style="display: none;">
          <div class="form-group">
            <label>PhÃ©p toÃ¡n cho batch:</label>
            <select id="batchOperation"></select>
          </div>
          <div class="form-group">
            <label>HÃ¬nh A:</label>
            <select id="batchShapeA"></select>
          </div>
          <div class="form-group">
            <label>HÃ¬nh B:</label>
            <select id="batchShapeB"></select>
          </div>
          <button class="btn" onclick="processBatchChunked()" id="processBatchBtn" disabled>ğŸš€ Xá»­ lÃ½ Batch</button>
          <div style="margin-top:10px;display:flex;gap:10px;align-items:center">
            <label for="chunkSize">KÃ­ch thÆ°á»›c má»—i Ä‘á»£t:</label>
            <input id="chunkSize" type="number" value="100" min="10" max="1000" style="width:120px"/>
          </div>
        </div>
        <div id="batchProgress" class="progress-section" style="display: none;">
          <h4>â³ Äang xá»­ lÃ½...</h4>
          <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
          <div id="progressText">0%</div>
        </div>
        <div id="batchResults" class="batch-results" style="display: none;">
          <h4>âœ… HoÃ n thÃ nh!</h4>
          <div id="batchSummary"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="assets/js/web_shared.js"></script>
  <script src="assets/js/web_core.js"></script>
  <script src="assets/js/web_parse.js"></script>
  <script src="assets/js/vis2d3d.js"></script>
  <script src="assets/js/web_excel.js"></script>
  <script src="assets/js/web_core_expose.js"></script>
  <script>
    window.addEventListener('load', ()=>{ initApp(); setupVisualization(); });
  </script>
</body>
</html>
