<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConvertKeylogApp Geometry API - Web Demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,.3); }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .main-content { padding: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .form-section { background: #f8f9fa; border-radius: 10px; padding: 20px; border: 2px solid #e9ecef; }
        .form-section h2 { font-size: 1.3em; margin-bottom: 15px; color: #2c3e50; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #2c3e50; }
        select, input { width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 14px; }
        button { width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        button:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102,126,234,.3); }
        .visualization-section { grid-column: 1 / -1; background: #f8f9fa; border-radius: 10px; padding: 20px; border: 2px solid #e9ecef; }
        .visualization-section h2 { font-size: 1.3em; margin-bottom: 15px; color: #2c3e50; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
        .canvas-controls { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .btn-small { background: #2196F3; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 13px; }
        .btn-small:hover { transform: translateY(-2px); }
        #geometryCanvas { width: 100%; height: 500px; border: 2px solid #e9ecef; border-radius: 10px; background: white; }
        .canvas-info { margin-top: 15px; padding: 12px; background: white; border-radius: 6px; text-align: center; color: #667eea; font-size: 14px; }
        .results-section { grid-column: 1 / -1; background: #f8f9fa; border-radius: 10px; padding: 20px; border: 2px solid #e9ecef; }
        .results-section h2 { font-size: 1.3em; margin-bottom: 15px; color: #2c3e50; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
        .result-item { background: white; padding: 12px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #667eea; }
        .result-item .keylog { background: #f0f4ff; padding: 8px; border-radius: 4px; font-family: 'Courier New', monospace; color: #667eea; margin-top: 8px; word-break: break-all; }
        .error { color: #e74c3c; padding: 10px; background: #fadbd8; border-radius: 6px; margin-top: 10px; }
        .success { color: #27ae60; padding: 10px; background: #d5f4e6; border-radius: 6px; margin-top: 10px; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üé® Geometry Mode with 3D Visualization</h1>
        <p>ConvertKeylogApp API - Interactive Geometry Solver + Real-time Canvas</p>
    </div>
    <div class="main-content">
        <div class="form-section">
            <h2>üìê Shape A</h2>
            <div class="form-group">
                <label>Shape Type</label>
                <select id="shapeA" onchange="updateFormA()">
                    <option value="">-- Select --</option>
                    <option value="Point">Point</option>
                    <option value="Line">Line</option>
                </select>
            </div>
            <div id="formA"></div>
        </div>
        <div class="form-section">
            <h2>üìê Shape B (Optional)</h2>
            <div class="form-group">
                <label>Shape Type</label>
                <select id="shapeB" onchange="updateFormB()">
                    <option value="">-- Select --</option>
                    <option value="Point">Point</option>
                    <option value="Line">Line</option>
                </select>
            </div>
            <div id="formB"></div>
        </div>
        <div class="visualization-section">
            <h2>üé® Real-time 3D Visualization Canvas</h2>
            <div class="canvas-controls">
                <button class="btn-small" onclick="resetCamera()">üîÑ Reset Camera</button>
                <label style="margin: 0; padding: 8px;"><input type="checkbox" id="showGrid" checked onchange="updateVis()"> Grid</label>
                <label style="margin: 0; padding: 8px;"><input type="checkbox" id="showAxes" checked onchange="updateVis()"> Axes</label>
            </div>
            <div id="geometryCanvas"></div>
            <div class="canvas-info" id="canvasStatus">üìä Select shapes and click "Visualize" to see the 3D plot</div>
        </div>
        <div class="results-section">
            <h2>‚úÖ Results</h2>
            <button onclick="visualizeGeometry()">üîç Visualize & Calculate</button>
            <div id="results"></div>
        </div>
    </div>
</div>
<script>
function updateFormA() {
    const shape = document.getElementById('shapeA').value;
    let html = '';
    if (shape === 'Point') {
        html = '<div class="form-group"><label>Point A (x,y,z)</label><input type="text" id="pointA" placeholder="0,0,0"></div>';
    } else if (shape === 'Line') {
        html = '<div class="form-group"><label>Point on line</label><input type="text" id="linePointA" placeholder="0,0,0"></div>';
        html += '<div class="form-group"><label>Direction vector</label><input type="text" id="lineDirA" placeholder="1,0,0"></div>';
    }
    document.getElementById('formA').innerHTML = html;
}

function updateFormB() {
    const shape = document.getElementById('shapeB').value;
    let html = '';
    if (shape === 'Point') {
        html = '<div class="form-group"><label>Point B (x,y,z)</label><input type="text" id="pointB" placeholder="0,0,0"></div>';
    } else if (shape === 'Line') {
        html = '<div class="form-group"><label>Point on line</label><input type="text" id="linePointB" placeholder="0,0,0"></div>';
        html += '<div class="form-group"><label>Direction vector</label><input type="text" id="lineDirB" placeholder="1,0,0"></div>';
    }
    document.getElementById('formB').innerHTML = html;
}

function initCanvas() {
    Plotly.newPlot('geometryCanvas', [], {
        title: '3D Geometry Visualization',
        scene: {
            xaxis: { title: 'X', range: [-10, 10] },
            yaxis: { title: 'Y', range: [-10, 10] },
            zaxis: { title: 'Z', range: [-10, 10] },
            aspectmode: 'cube'
        },
        margin: { l: 0, r: 0, b: 0, t: 40 }
    }, { responsive: true });
}

function visualizeGeometry() {
    const shapeA = document.getElementById('shapeA').value;
    if (!shapeA) { alert('Select Shape A'); return; }
    
    const traces = [];
    
    if (shapeA === 'Point') {
        const coords = document.getElementById('pointA').value.split(',').map(s => parseFloat(s.trim())||0);
        traces.push({
            type: 'scatter3d',
            mode: 'markers',
            x: [coords[0]],
            y: [coords[1]],
            z: [coords[2]||0],
            marker: { size: 10, color: '#4CAF50' },
            name: 'Point A'
        });
    }
    
    const shapeB = document.getElementById('shapeB').value;
    if (shapeB === 'Point') {
        const coords = document.getElementById('pointB').value.split(',').map(s => parseFloat(s.trim())||0);
        traces.push({
            type: 'scatter3d',
            mode: 'markers',
            x: [coords[0]],
            y: [coords[1]],
            z: [coords[2]||0],
            marker: { size: 10, color: '#2196F3' },
            name: 'Point B'
        });
    }
    
    const layout = {
        title: shapeA + (shapeB ? ' & ' + shapeB : ''),
        scene: {
            xaxis: { title: 'X', range: [-10, 10], showgrid: document.getElementById('showGrid').checked },
            yaxis: { title: 'Y', range: [-10, 10], showgrid: document.getElementById('showGrid').checked },
            zaxis: { title: 'Z', range: [-10, 10], showgrid: document.getElementById('showGrid').checked },
            aspectmode: 'cube'
        },
        margin: { l: 0, r: 0, b: 0, t: 40 }
    };
    
    Plotly.newPlot('geometryCanvas', traces, layout, { responsive: true });
    document.getElementById('canvasStatus').textContent = '‚úÖ Visualization ready!';
    document.getElementById('results').innerHTML = '<div class="success">‚úÖ Canvas rendered successfully!</div>';
}

function resetCamera() {
    Plotly.relayout('geometryCanvas', {
        'scene.camera': { eye: { x: 1.5, y: 1.5, z: 1.5 } }
    });
}

function updateVis() {
    visualizeGeometry();
}

window.addEventListener('load', () => { initCanvas(); });
</script>
</body>
</html>
