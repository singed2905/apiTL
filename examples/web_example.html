<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConvertKeylogApp Geometry API - Web Demo</title>
    <style>
        /* ... gi·ªØ nguy√™n styles c≈© ... */
        .excel-section { background: #f8f9fa; border-radius: 10px; padding: 25px; border: 2px solid #e9ecef; margin-top: 20px; }
        .upload-zone { border: 2px dashed #4CAF50; border-radius: 10px; padding: 40px; text-align: center; cursor: pointer; transition: background-color 0.3s; }
        .upload-zone:hover { background-color: #f0f8f0; }
        .upload-icon { font-size: 3em; margin-bottom: 10px; }
        .file-info { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #dee2e6; }
        .preview-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .preview-table th,.preview-table td { border: 1px solid #dee2e6; padding: 8px; text-align: left; }
        .preview-table th { background-color: #f8f9fa; font-weight: 600; }
        .progress-section { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .progress-bar { width: 100%; height: 20px; background-color: #e9ecef; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: linear-gradient(45deg, #4CAF50, #45a049); width: 0%; transition: width 0.3s ease; }
        .batch-results { background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; padding: 20px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <!-- gi·ªØ nguy√™n header v√† main-content c≈© -->
        <div class="excel-section" style="grid-column: 1 / -1;">
            <h3>üìä Excel Batch Processing</h3>
            <div class="upload-area" id="uploadArea">
                <input type="file" id="excelFile" accept=".xlsx,.xls" style="display: none;" onchange="handleFileUpload()">
                <div class="upload-zone" onclick="document.getElementById('excelFile').click()">
                    <div class="upload-icon">üìÅ</div>
                    <p>Click ƒë·ªÉ ch·ªçn file Excel ho·∫∑c k√©o th·∫£ v√†o ƒë√¢y</p>
                    <small>H·ªó tr·ª£ .xlsx v√† .xls</small>
                </div>
            </div>
            <div id="fileInfo" class="file-info" style="display: none;">
                <h4>üìã Th√¥ng tin file:</h4>
                <div id="fileDetails"></div>
                <div id="previewTable"></div>
            </div>
            <div id="processingConfig" class="processing-config" style="display: none;">
                <div class="form-group">
                    <label>Ph√©p to√°n cho batch:</label>
                    <select id="batchOperation"></select>
                </div>
                <div class="form-group">
                    <label>H√¨nh A:</label>
                    <select id="batchShapeA"></select>
                </div>
                <div class="form-group">
                    <label>H√¨nh B:</label>
                    <select id="batchShapeB"></select>
                </div>
                <button class="btn" onclick="processBatch()" id="processBatchBtn">üöÄ X·ª≠ l√Ω Batch</button>
            </div>
            <div id="batchProgress" class="progress-section" style="display: none;">
                <h4>‚è≥ ƒêang x·ª≠ l√Ω...</h4>
                <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                <div id="progressText">0%</div>
            </div>
            <div id="batchResults" class="batch-results" style="display: none;">
                <h4>‚úÖ Ho√†n th√†nh!</h4>
                <div id="batchSummary"></div>
                <button class="btn" onclick="downloadResult()" id="downloadBtn">üíæ T·∫£i v·ªÅ k·∫øt qu·∫£</button>
            </div>
        </div>
    </div>
    <script>
        const API_BASE = 'http://localhost:5000';
        // ... gi·ªØ nguy√™n JS c≈© ...
        let currentFilePath = null; let currentFileName = null;
        async function handleFileUpload(){const f=document.getElementById('excelFile').files[0];if(!f)return;const fd=new FormData();fd.append('file',f);const res=await fetch(`${API_BASE}/api/geometry/excel/upload`,{method:'POST',body:fd});const r=await res.json();if(r.status==='success'){currentFilePath=r.filepath;currentFileName=r.filename;displayFileInfo(r);}else{showError('Upload failed: '+r.message);}}
        function displayFileInfo(r){document.getElementById('fileInfo').style.display='block';document.getElementById('processingConfig').style.display='block';document.getElementById('fileDetails').innerHTML=`<p><strong>T√™n file:</strong> ${r.filename}</p><p><strong>T·ªïng s·ªë d√≤ng:</strong> ${r.total_rows}</p><p><strong>K√≠ch th∆∞·ªõc:</strong> ${r.file_size_mb} MB</p>`;let h='<h5>Preview (5 d√≤ng ƒë·∫ßu):</h5><table class="preview-table"><thead><tr>';r.columns.forEach(c=>h+=`<th>${c}</th>`);h+='</tr></thead><tbody>';r.preview.forEach(row=>{h+='<tr>';r.columns.forEach(c=>{h+=`<td>${row[c]??''}</td>`});h+='</tr>';});h+='</tbody></table>';document.getElementById('previewTable').innerHTML=h;populateBatchConfig();}
        function populateBatchConfig(){document.getElementById('batchOperation').innerHTML=document.getElementById('operation').innerHTML;document.getElementById('batchShapeA').innerHTML=document.getElementById('shapeA').innerHTML;document.getElementById('batchShapeB').innerHTML=document.getElementById('shapeB').innerHTML;}
        async function processBatch(){const operation=document.getElementById('batchOperation').value;const shapeA=document.getElementById('batchShapeA').value;const shapeB=document.getElementById('batchShapeB').value; if(!operation||!shapeA||!currentFilePath){showError('Vui l√≤ng ch·ªçn ƒë·ªß th√¥ng tin v√† upload file');return;} const body={filepath:currentFilePath,operation:operation,shape_A:shapeA,shape_B:shapeB||null}; showBatchProgress(); const res=await fetch(`${API_BASE}/api/geometry/excel/process`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); const r=await res.json(); if(r.status==='success'){showBatchResults(r);} else {showError('Batch processing failed: '+r.message);} }
        function showBatchProgress(){document.getElementById('batchProgress').style.display='block';document.getElementById('processBatchBtn').disabled=true; let p=0; const it=setInterval(()=>{p+=Math.random()*20; if(p>=90){clearInterval(it);p=90;} updateProgress(p);},500);} 
        function updateProgress(x){document.getElementById('progressFill').style.width=x+'%';document.getElementById('progressText').textContent=Math.round(x)+'%';}
        function showBatchResults(r){document.getElementById('batchProgress').style.display='none';document.getElementById('batchResults').style.display='block';document.getElementById('batchSummary').innerHTML=`<p><strong>ƒê√£ x·ª≠ l√Ω:</strong> ${r.processed_rows} d√≤ng</p><p><strong>File k·∫øt qu·∫£:</strong> ${r.output_file}</p>`; window.resultFilePath=r.output_file;}
        function downloadResult(){if(window.resultFilePath){const fn=window.resultFilePath.split('/').pop();window.open(`${API_BASE}/api/geometry/excel/download/${fn}`,'_blank');}}
    </script>
</body>
</html>