<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConvertKeylogApp Geometry API - Web Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #4CAF50, #2196F3);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .form-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 2px solid #e9ecef;
        }

        .form-section h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .results-section {
            background: #fff;
            border-radius: 10px;
            padding: 25px;
            border: 2px solid #e9ecef;
        }

        .result-item {
            background: #f8f9fa;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 0 6px 6px 0;
        }

        .result-item h4 {
            color: #495057;
            margin-bottom: 8px;
        }

        .keylog {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            word-break: break-all;
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }

        .shape-inputs {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #ffffff;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        .shape-inputs.active {
            display: block;
        }

        .examples-section {
            grid-column: 1 / -1;
            background: #e8f5e8;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
        }

        .example-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        .example-btn:hover {
            background: #138496;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßÆ ConvertKeylogApp Geometry API</h1>
            <p>Web Demo - Chuy·ªÉn ƒë·ªïi b√†i to√°n h√¨nh h·ªçc th√†nh keylog m√°y t√≠nh Casio</p>
        </div>

        <div class="main-content">
            <!-- Input Form -->
            <div class="form-section">
                <h3>üìù Nh·∫≠p d·ªØ li·ªáu</h3>
                
                <div class="form-group">
                    <label for="operation">Ph√©p to√°n:</label>
                    <select id="operation" onchange="updateShapeOptions()">
                        <option value="">Ch·ªçn ph√©p to√°n...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="shapeA">H√¨nh A:</label>
                    <select id="shapeA" onchange="updateInputFields()">
                        <option value="">Ch·ªçn h√¨nh A...</option>
                    </select>
                </div>

                <div id="inputsA" class="shape-inputs">
                    <!-- Dynamic inputs for shape A -->
                </div>

                <div class="form-group">
                    <label for="shapeB">H√¨nh B (t√πy ch·ªçn):</label>
                    <select id="shapeB" onchange="updateInputFields()">
                        <option value="">Kh√¥ng c√≥</option>
                    </select>
                </div>

                <div id="inputsB" class="shape-inputs">
                    <!-- Dynamic inputs for shape B -->
                </div>

                <div class="form-group">
                    <label for="version">Phi√™n b·∫£n m√°y t√≠nh:</label>
                    <select id="version">
                        <option value="fx799">Casio fx-799</option>
                        <option value="fx800">Casio fx-800</option>
                        <option value="fx801">Casio fx-801</option>
                        <option value="fx802">Casio fx-802</option>
                        <option value="fx803">Casio fx-803</option>
                    </select>
                </div>

                <button class="btn" onclick="processGeometry()" id="processBtn">
                    üöÄ T√≠nh to√°n
                </button>
            </div>

            <!-- Results -->
            <div class="results-section">
                <h3>üìä K·∫øt qu·∫£</h3>
                <div id="results">
                    <div class="loading">Nh·∫≠p d·ªØ li·ªáu v√† nh·∫•n "T√≠nh to√°n" ƒë·ªÉ xem k·∫øt qu·∫£...</div>
                </div>
            </div>

            <!-- Examples -->
            <div class="examples-section">
                <h3>üí° V√≠ d·ª• nhanh</h3>
                <p style="margin-bottom: 15px;">Nh·∫•n v√†o m·ªôt v√≠ d·ª• ƒë·ªÉ t·ª± ƒë·ªông ƒëi·ªÅn d·ªØ li·ªáu:</p>
                
                <button class="example-btn" onclick="loadExample('distance_points')">
                    Kho·∫£ng c√°ch 2 ƒëi·ªÉm
                </button>
                <button class="example-btn" onclick="loadExample('circle_area')">
                    Di·ªán t√≠ch ƒë∆∞·ªùng tr√≤n
                </button>
                <button class="example-btn" onclick="loadExample('sphere_volume')">
                    Th·ªÉ t√≠ch m·∫∑t c·∫ßu
                </button>
                <button class="example-btn" onclick="loadExample('line_plane_intersection')">
                    Giao tuy·∫øn ƒë∆∞·ªùng th·∫≥ng - m·∫∑t ph·∫≥ng
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';
        let availableShapes = [];
        let availableOperations = [];

        // Initialize the app
        async function initApp() {
            try {
                // Load shapes and operations
                const [shapesRes, operationsRes] = await Promise.all([
                    fetch(`${API_BASE}/api/geometry/shapes`),
                    fetch(`${API_BASE}/api/geometry/operations`)
                ]);

                const shapesData = await shapesRes.json();
                const operationsData = await operationsRes.json();

                availableShapes = shapesData.data;
                availableOperations = operationsData.data;

                populateOperations();
                populateShapes();
            } catch (error) {
                showError('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn API. Vui l√≤ng ki·ªÉm tra server ƒë√£ ch·∫°y ch∆∞a.');
                console.error('Init error:', error);
            }
        }

        function populateOperations() {
            const select = document.getElementById('operation');
            select.innerHTML = '<option value="">Ch·ªçn ph√©p to√°n...</option>';
            
            availableOperations.forEach(op => {
                const option = document.createElement('option');
                option.value = op;
                option.textContent = op;
                select.appendChild(option);
            });
        }

        function populateShapes() {
            const selectA = document.getElementById('shapeA');
            const selectB = document.getElementById('shapeB');
            
            selectA.innerHTML = '<option value="">Ch·ªçn h√¨nh A...</option>';
            selectB.innerHTML = '<option value="">Kh√¥ng c√≥</option>';
            
            availableShapes.forEach(shape => {
                const optionA = document.createElement('option');
                optionA.value = shape;
                optionA.textContent = shape;
                selectA.appendChild(optionA);
                
                const optionB = document.createElement('option');
                optionB.value = shape;
                optionB.textContent = shape;
                selectB.appendChild(optionB);
            });
        }

        async function updateShapeOptions() {
            const operation = document.getElementById('operation').value;
            if (!operation) return;

            try {
                const response = await fetch(`${API_BASE}/api/geometry/operations/${encodeURIComponent(operation)}/shapes`);
                const data = await response.json();
                
                const selectA = document.getElementById('shapeA');
                const selectB = document.getElementById('shapeB');
                
                // Update shape A options
                selectA.innerHTML = '<option value="">Ch·ªçn h√¨nh A...</option>';
                data.data.forEach(shape => {
                    const option = document.createElement('option');
                    option.value = shape;
                    option.textContent = shape;
                    selectA.appendChild(option);
                });
                
                // Update shape B options
                selectB.innerHTML = '<option value="">Kh√¥ng c√≥</option>';
                if (!['Di·ªán t√≠ch', 'Th·ªÉ t√≠ch'].includes(operation)) {
                    data.data.forEach(shape => {
                        const option = document.createElement('option');
                        option.value = shape;
                        option.textContent = shape;
                        selectB.appendChild(option);
                    });
                }
                
                updateInputFields();
            } catch (error) {
                console.error('Error updating shapes:', error);
            }
        }

        function updateInputFields() {
            const shapeA = document.getElementById('shapeA').value;
            const shapeB = document.getElementById('shapeB').value;
            
            updateShapeInputs('A', shapeA);
            updateShapeInputs('B', shapeB);
        }

        function updateShapeInputs(group, shape) {
            const container = document.getElementById(`inputs${group}`);
            container.innerHTML = '';
            
            if (!shape) {
                container.classList.remove('active');
                return;
            }
            
            container.classList.add('active');
            
            switch (shape) {
                case 'ƒêi·ªÉm':
                    container.innerHTML = `
                        <label>T·ªça ƒë·ªô (x,y,z):</label>
                        <input type="text" id="point_input_${group}" placeholder="V√≠ d·ª•: 1,2,3">
                    `;
                    break;
                    
                case 'ƒê∆∞·ªùng th·∫≥ng':
                    container.innerHTML = `
                        <label>ƒêi·ªÉm tr√™n ƒë∆∞·ªùng th·∫≥ng (x,y,z):</label>
                        <input type="text" id="line_A${group === 'A' ? '1' : '2'}_${group}" placeholder="V√≠ d·ª•: 0,0,0">
                        <label style="margin-top: 10px;">Vector ch·ªâ ph∆∞∆°ng (dx,dy,dz):</label>
                        <input type="text" id="line_X${group === 'A' ? '1' : '2'}_${group}" placeholder="V√≠ d·ª•: 1,1,1">
                    `;
                    break;
                    
                case 'M·∫∑t ph·∫≥ng':
                    container.innerHTML = `
                        <label>H·ªá s·ªë a:</label>
                        <input type="text" id="plane_a_${group}" placeholder="V√≠ d·ª•: 1">
                        <label>H·ªá s·ªë b:</label>
                        <input type="text" id="plane_b_${group}" placeholder="V√≠ d·ª•: 1">
                        <label>H·ªá s·ªë c:</label>
                        <input type="text" id="plane_c_${group}" placeholder="V√≠ d·ª•: 1">
                        <label>H·∫±ng s·ªë d:</label>
                        <input type="text" id="plane_d_${group}" placeholder="V√≠ d·ª•: 0">
                    `;
                    break;
                    
                case 'ƒê∆∞·ªùng tr√≤n':
                    container.innerHTML = `
                        <label>T√¢m ƒë∆∞·ªùng tr√≤n (x,y):</label>
                        <input type="text" id="circle_center_${group}" placeholder="V√≠ d·ª•: 0,0">
                        <label style="margin-top: 10px;">B√°n k√≠nh:</label>
                        <input type="text" id="circle_radius_${group}" placeholder="V√≠ d·ª•: 5">
                    `;
                    break;
                    
                case 'M·∫∑t c·∫ßu':
                    container.innerHTML = `
                        <label>T√¢m m·∫∑t c·∫ßu (x,y,z):</label>
                        <input type="text" id="sphere_center_${group}" placeholder="V√≠ d·ª•: 0,0,0">
                        <label style="margin-top: 10px;">B√°n k√≠nh:</label>
                        <input type="text" id="sphere_radius_${group}" placeholder="V√≠ d·ª•: 3">
                    `;
                    break;
            }
        }

        function collectInputData(group, shape) {
            const data = {};
            
            switch (shape) {
                case 'ƒêi·ªÉm':
                    const pointInput = document.getElementById(`point_input_${group}`);
                    if (pointInput) data.point_input = pointInput.value;
                    break;
                    
                case 'ƒê∆∞·ªùng th·∫≥ng':
                    const lineA = document.getElementById(`line_A${group === 'A' ? '1' : '2'}_${group}`);
                    const lineX = document.getElementById(`line_X${group === 'A' ? '1' : '2'}_${group}`);
                    if (lineA) data[`line_A${group === 'A' ? '1' : '2'}`] = lineA.value;
                    if (lineX) data[`line_X${group === 'A' ? '1' : '2'}`] = lineX.value;
                    break;
                    
                case 'M·∫∑t ph·∫≥ng':
                    ['a', 'b', 'c', 'd'].forEach(coeff => {
                        const input = document.getElementById(`plane_${coeff}_${group}`);
                        if (input) data[`plane_${coeff}`] = input.value;
                    });
                    break;
                    
                case 'ƒê∆∞·ªùng tr√≤n':
                    const circleCenter = document.getElementById(`circle_center_${group}`);
                    const circleRadius = document.getElementById(`circle_radius_${group}`);
                    if (circleCenter) data.circle_center = circleCenter.value;
                    if (circleRadius) data.circle_radius = circleRadius.value;
                    break;
                    
                case 'M·∫∑t c·∫ßu':
                    const sphereCenter = document.getElementById(`sphere_center_${group}`);
                    const sphereRadius = document.getElementById(`sphere_radius_${group}`);
                    if (sphereCenter) data.sphere_center = sphereCenter.value;
                    if (sphereRadius) data.sphere_radius = sphereRadius.value;
                    break;
            }
            
            return data;
        }

        async function processGeometry() {
            const operation = document.getElementById('operation').value;
            const shapeA = document.getElementById('shapeA').value;
            const shapeB = document.getElementById('shapeB').value;
            const version = document.getElementById('version').value;
            
            if (!operation || !shapeA) {
                showError('Vui l√≤ng ch·ªçn ph√©p to√°n v√† h√¨nh A.');
                return;
            }
            
            const dataA = collectInputData('A', shapeA);
            const dataB = shapeB ? collectInputData('B', shapeB) : {};
            
            const requestData = {
                operation,
                shape_A: shapeA,
                data_A: dataA,
                version
            };
            
            if (shapeB) {
                requestData.shape_B = shapeB;
                requestData.data_B = dataB;
            }
            
            // Show loading
            document.getElementById('results').innerHTML = '<div class="loading">üîÑ ƒêang x·ª≠ l√Ω...</div>';
            document.getElementById('processBtn').disabled = true;
            
            try {
                const response = await fetch(`${API_BASE}/api/geometry/process`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    displayResults(result.data);
                } else {
                    showError(result.message);
                }
            } catch (error) {
                showError('L·ªói k·∫øt n·ªëi ƒë·∫øn API: ' + error.message);
                console.error('Processing error:', error);
            } finally {
                document.getElementById('processBtn').disabled = false;
            }
        }

        function displayResults(data) {
            const resultsContainer = document.getElementById('results');
            
            const keylogHtml = `
                <div class="result-item">
                    <h4>üîë Keylog (${data.version}):</h4>
                    <div class="keylog">
                        ${data.keylog}
                        <button class="copy-btn" onclick="copyToClipboard('${data.keylog}')">Copy</button>
                    </div>
                </div>
                
                <div class="result-item">
                    <h4>üìù Th√¥ng tin:</h4>
                    <p><strong>Ph√©p to√°n:</strong> ${data.operation}</p>
                    <p><strong>H√¨nh A:</strong> ${data.shape_A}</p>
                    ${data.shape_B ? `<p><strong>H√¨nh B:</strong> ${data.shape_B}</p>` : ''}
                    <p><strong>M√£ h√≥a A:</strong> [${data.encoded_A.join(', ')}]</p>
                    ${data.encoded_B && data.encoded_B.length > 0 ? `<p><strong>M√£ h√≥a B:</strong> [${data.encoded_B.join(', ')}]</p>` : ''}
                </div>
                
                <div class="success">
                    ‚úÖ X·ª≠ l√Ω th√†nh c√¥ng! Sao ch√©p keylog v√† nh·∫≠p v√†o m√°y t√≠nh Casio.
                </div>
            `;
            
            resultsContainer.innerHTML = keylogHtml;
        }

        function showError(message) {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = `<div class="error">‚ùå ${message}</div>`;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Visual feedback
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.style.background = '#27ae60';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#3498db';
                }, 1500);
            }).catch(err => {
                console.error('Copy failed:', err);
                alert('Kh√¥ng th·ªÉ copy. Vui l√≤ng copy th·ªß c√¥ng.');
            });
        }

        // Example data
        const examples = {
            distance_points: {
                operation: 'Kho·∫£ng c√°ch',
                shapeA: 'ƒêi·ªÉm',
                shapeB: 'ƒêi·ªÉm',
                dataA: { point_input: '1,2,3' },
                dataB: { point_input: '4,5,6' }
            },
            circle_area: {
                operation: 'Di·ªán t√≠ch',
                shapeA: 'ƒê∆∞·ªùng tr√≤n',
                dataA: { circle_center: '0,0', circle_radius: 'sqrt(5)' }
            },
            sphere_volume: {
                operation: 'Th·ªÉ t√≠ch',
                shapeA: 'M·∫∑t c·∫ßu',
                dataA: { sphere_center: '0,0,0', sphere_radius: '3' }
            },
            line_plane_intersection: {
                operation: 'T∆∞∆°ng giao',
                shapeA: 'ƒê∆∞·ªùng th·∫≥ng',
                shapeB: 'M·∫∑t ph·∫≥ng',
                dataA: { line_A1: '0,0,0', line_X1: '1,1,1' },
                dataB: { plane_a: '1', plane_b: '1', plane_c: '1', plane_d: '0' }
            }
        };

        function loadExample(exampleKey) {
            const example = examples[exampleKey];
            if (!example) return;

            // Set operation
            document.getElementById('operation').value = example.operation;
            updateShapeOptions().then(() => {
                // Set shapes
                document.getElementById('shapeA').value = example.shapeA;
                if (example.shapeB) {
                    document.getElementById('shapeB').value = example.shapeB;
                }
                
                updateInputFields();
                
                // Wait a bit for inputs to be created, then populate
                setTimeout(() => {
                    // Populate data A
                    Object.entries(example.dataA).forEach(([key, value]) => {
                        const input = document.getElementById(`${key}_A`);
                        if (input) input.value = value;
                    });
                    
                    // Populate data B if exists
                    if (example.dataB) {
                        Object.entries(example.dataB).forEach(([key, value]) => {
                            const input = document.getElementById(`${key}_B`);
                            if (input) input.value = value;
                        });
                    }
                }, 100);
            });
        }

        // Initialize app when page loads
        window.addEventListener('load', initApp);
    </script>
</body>
</html>